# Node.js dgram API å…¼å®¹æ€§æŠ¥å‘Š

æœ¬æ–‡ä»¶è¯¦ç»†è¯´æ˜äº† `react-native-nitro-dgram` ä¸ Node.js å®˜æ–¹ `dgram` æ¨¡å—çš„å…¼å®¹æ€§çŠ¶æ€ã€‚

## æ€»ä½“çŠ¶æ€
- **å…¼å®¹æ€§è¯„åˆ†**: **100%** ğŸš€
- **æ ¸å¿ƒç›®æ ‡**: å…è®¸ç°æœ‰çš„ Node.js `dgram` ä»£ç åœ¨ React Native ä¸­æ— ç¼è¿è¡Œï¼Œæ— éœ€ä¿®æ”¹ã€‚

---

## æ¨¡å—å‡½æ•° (Module Functions)

| å‡½æ•° | çŠ¶æ€ | è¯´æ˜ |
| :--- | :--- | :--- |
| `createSocket(options[, callback])` | âœ… å…¼å®¹ | æ”¯æŒ `SocketOptions` å’Œä¼ ç»Ÿçš„ `type` å­—ç¬¦ä¸²ã€‚æ”¯æŒ `signal`, `lookup` ç­‰é«˜çº§é€‰é¡¹ã€‚ |
| `createSocket(type[, callback])` | âœ… å…¼å®¹ | å®Œå…¨ä¸€è‡´ã€‚ |

## Socket äº‹ä»¶ (Socket Events)

| äº‹ä»¶ | çŠ¶æ€ | è¯´æ˜ |
| :--- | :--- | :--- |
| `'close'` | âœ… å…¼å®¹ | Socket å…³é—­æ—¶è§¦å‘ã€‚ |
| `'connect'` | âœ… å…¼å®¹ | è°ƒç”¨ `connect()` æˆåŠŸåè§¦å‘ã€‚ |
| `'error'` | âœ… å…¼å®¹ | å‘ç”Ÿç³»ç»Ÿçº§é”™è¯¯æ—¶è§¦å‘ã€‚ |
| `'listening'` | âœ… å…¼å®¹ | `bind()` æˆåŠŸåè§¦å‘ã€‚ |
| `'message'` | âœ… å…¼å®¹ | æ”¶åˆ°æ–°æ•°æ®æŠ¥æ—¶è§¦å‘ï¼Œå‚æ•° `(msg: Buffer, rinfo: RemoteInfo)` å®Œå…¨ä¸€è‡´ã€‚ |

## Socket æ–¹æ³• (Socket Methods)

| æ–¹æ³• | çŠ¶æ€ | è¯´æ˜ |
| :--- | :--- | :--- |
| `addMembership()` | âœ… å…¼å®¹ | æ”¯æŒåŠ å…¥å¤šæ’­ç»„ã€‚ |
| `dropMembership()` | âœ… å…¼å®¹ | æ”¯æŒé€€å‡ºå¤šæ’­ç»„ã€‚ |
| `addSourceSpecificMembership()` | âœ… å…¼å®¹ | æ”¯æŒ SSM (Source-Specific Multicast)ã€‚ |
| `dropSourceSpecificMembership()` | âœ… å…¼å®¹ | æ”¯æŒ SSMã€‚ |
| `address()` | âœ… å…¼å®¹ | è¿”å› `{ address, family, port }`ã€‚ |
| `bind()` | âœ… å…¼å®¹ | æ”¯æŒå¤šç§é‡è½½å½¢å¼ (`port`, `address`, `options`)ã€‚ |
| `close()` | âœ… å…¼å®¹ | å®Œå…¨ä¸€è‡´ã€‚ |
| `connect()` | âœ… å…¼å®¹ | æ”¯æŒè¿æ¥æ¨¡å¼ï¼Œå…è®¸ `send()` æ— éœ€åœ°å€ã€‚ |
| `disconnect()` | âœ… å…¼å®¹ | æ–­å¼€ UDP è™šè¿æ¥ã€‚ |
| `send()` | âœ… å…¼å®¹ | **æ”¯æŒå• Bufferã€å­—ç¬¦ä¸²ï¼Œä»¥åŠ Buffer æ•°ç»„ (Scatter-Gather)**ã€‚å®Œå…¨å¯¹é½åç§»é‡/é•¿åº¦å‚æ•°ã€‚ |
| `setBroadcast()` | âœ… å…¼å®¹ | å¼€å¯/å…³é—­å¹¿æ’­ã€‚ |
| `setMulticastInterface()` | âœ… å…¼å®¹ | è®¾ç½®å¤šæ’­æ¥å£ã€‚ |
| `setMulticastLoopback()` | âœ… å…¼å®¹ | å¼€å…³å¤šæ’­å›ç¯ã€‚ |
| `setMulticastTTL()` | âœ… å…¼å®¹ | è®¾ç½®å¤šæ’­ TTLã€‚ |
| `setTTL()` | âœ… å…¼å®¹ | è®¾ç½®æ•°æ®æŠ¥ TTLã€‚ |
| `getRecvBufferSize()` | âœ… å…¼å®¹ | è·å–ç³»ç»Ÿæ¥æ”¶ç¼“å†²åŒºå¤§å°ã€‚ |
| `setRecvBufferSize()` | âœ… å…¼å®¹ | è®¾ç½®ç³»ç»Ÿæ¥æ”¶ç¼“å†²åŒºå¤§å°ã€‚ |
| `getSendBufferSize()` | âœ… å…¼å®¹ | è·å–ç³»ç»Ÿå‘é€ç¼“å†²åŒºå¤§å°ã€‚ |
| `setSendBufferSize()` | âœ… å…¼å®¹ | è®¾ç½®ç³»ç»Ÿå‘é€ç¼“å†²åŒºå¤§å°ã€‚ |
| `getSendQueueSize()` | âœ… å…¼å®¹ | è·å–å‘é€é˜Ÿåˆ—ä¸­çš„å­—èŠ‚æ€»æ•°ã€‚ |
| `getSendQueueCount()` | âœ… å…¼å®¹ | è·å–å‘é€é˜Ÿåˆ—ä¸­çš„æ•°æ®åŒ…æ€»æ•°ã€‚ |
| `remoteAddress()` | âœ… å…¼å®¹ | è·å–å·²è¿æ¥å¯¹ç«¯çš„åœ°å€ä¿¡æ¯ã€‚ |
| `[Symbol.asyncDispose]` | âœ… å…¼å®¹ | æ”¯æŒç°ä»£ `await using` è¯­æ³•è¿›è¡Œè‡ªåŠ¨èµ„æºé‡Šæ”¾ã€‚ |

## Socket é€‰é¡¹ (SocketOptions)

| é€‰é¡¹ | çŠ¶æ€ | è¯´æ˜ |
| :--- | :--- | :--- |
| `type` | âœ… å…¼å®¹ | `'udp4'` æˆ– `'udp6'`ã€‚ |
| `reuseAddr` | âœ… å…¼å®¹ | åœ°å€é‡ç”¨æ”¯æŒã€‚ |
| `reusePort` | âœ… å…¼å®¹ | ç«¯å£é‡ç”¨æ”¯æŒã€‚ |
| `ipv6Only` | âœ… å…¼å®¹ | IPv6 ä¸“ç”¨æ¨¡å¼ã€‚ |
| `recvBufferSize` | âœ… å…¼å®¹ | åˆå§‹æ¥æ”¶ç¼“å†²åŒºã€‚ |
| `sendBufferSize` | âœ… å…¼å®¹ | åˆå§‹å‘é€ç¼“å†²åŒºã€‚ |
| `lookup` | âœ… å…¼å®¹ | æ”¯æŒè‡ªå®šä¹‰ DNS è§£æå‡½æ•°ã€‚ |
| `signal` | âœ… å…¼å®¹ | æ”¯æŒ `AbortSignal` è¿›è¡Œ Socket ä¸­æ­¢ã€‚ |
| `receiveBlockList` | âœ… å…¼å®¹ | æ”¯æŒ IP é»‘åå•æ‹¦æˆªï¼ˆæ¥æ”¶ï¼‰ã€‚ |
| `sendBlockList` | âœ… å…¼å®¹ | æ”¯æŒ IP é»‘åå•æ‹¦æˆªï¼ˆå‘é€ï¼‰ã€‚ |

---

## è¡Œä¸ºå·®å¼‚è¯´æ˜ (Behavioral Notes)

1.  **EventEmitter**: ä½¿ç”¨ `eventemitter3` å®ç°ï¼ŒAPI å®Œå…¨å¯¹é½ Node.jsï¼Œä½†æ€§èƒ½æ›´é«˜ä¸”é€‚åˆç§»åŠ¨ç«¯ã€‚
2.  **å¼‚æ­¥è°ƒåº¦**: ä½¿ç”¨ React Native åŸç”Ÿçš„ `setImmediate` å®ç°ï¼Œå…¶æ•ˆæœä¸ Node.js çš„ `process.nextTick` åŸºæœ¬ä¸€è‡´ã€‚
3.  **Buffer**: ä½¿ç”¨ `react-native-nitro-buffer` æä¾›çš„é«˜æ€§èƒ½ Buffer å®ç°ï¼Œæ”¯æŒä¸åŸç”Ÿ ArrayBuffer æ— æŸè½¬æ¢ã€‚

---

## å®æ–½è·¯çº¿å›¾

- [x] **Phase 1: è¿æ¥æ¨¡å¼ (Connected Sockets)** - å·²å®Œæˆ
- [x] **Phase 2: ç¼“å†²åŒºä¸çŠ¶æ€ç®¡ç†** - å·²å®Œæˆ
- [x] **Phase 3: ç°ä»£ JS ç‰¹æ€§ (AbortSignal/AsyncDispose)** - å·²å®Œæˆ
- [x] **Phase 4: DNS ä¸ å®‰å…¨è¿‡æ»¤ (BlockList)** - å·²å®Œæˆ
- [x] **Phase 5: é«˜çº§åŠŸèƒ½ (SSM/Queue/Scatter-Gather)** - å·²å®Œæˆ (100% è¾¾æˆ)

---

*æœ€åæ›´æ–°æ—¥æœŸ: 2024-12-26*
